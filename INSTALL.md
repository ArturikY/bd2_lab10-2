# Инструкция по установке и запуску

## Требования
- PHP 7.0 или выше
- MySQL 5.7 или выше
- Веб-сервер (Apache/Nginx) или встроенный PHP сервер

## Установка

### 1. Создание базы данных

Выполните SQL-скрипт для создания структуры базы данных:

```bash
mysql -u root -p < database_schema.sql
```

Или вручную в MySQL:
```sql
SOURCE database_schema.sql;
```

### 2. Настройка подключения к БД

Откройте файл `config.php` и при необходимости измените параметры подключения:

```php
$db_host = 'localhost';
$db_user = 'root';
$db_password = '';
$database = 'bd_lab10-2';
```

### 3. Запуск веб-сервера

#### Вариант 1: Встроенный PHP сервер
```bash
php -S localhost:8000
```

#### Вариант 2: Apache/Nginx
Поместите файлы в директорию веб-сервера (например, `htdocs` или `www`).

## Использование

### Главная страница со всеми заданиями
Откройте в браузере:
```
http://localhost:8000/tasks_index.php
```

### Доступ к отдельным заданиям

- **Задание 1**: `http://localhost:8000/index.php`
- **Задание 2**: `http://localhost:8000/task2_index.php`
- **Задание 3**: `http://localhost:8000/task3_index.php`
- **Задание 4**: `http://localhost:8000/task4_index.php?device_token=token_device_1`
- **Задание 5**: `http://localhost:8000/task5_index.php`
- **Задание 6**: `http://localhost:8000/task6_index.php`
- **Задание 7**: `http://localhost:8000/task7_index.php`
- **Задание 8**: `http://localhost:8000/task8_index.php`

### API для устройства

Устройство может отправлять данные и получать команды через:
```
http://localhost:8000/device_status.php?ID=1&Term=25&Rele=1
```

Параметры:
- `ID` - ID устройства
- `Term` - температура
- `Rele` - состояние реле (0 или 1)

Ответ: `COMMAND 1 EOC` или `COMMAND 0 EOC`

### История управления устройством

```
http://localhost:8000/history.php?device_id=1
```

## Тестовые данные

После выполнения `database_schema.sql` в базе данных будут созданы:
- 3 тестовых устройства (ID: 1, 2, 3)
- 1 тестовый пользователь (ID: 1, username: 'admin')
- Токены устройств: `token_device_1`, `token_device_2`, `token_device_3`

## Проверка работы триггеров

### Триггер блокировки пользователя (Задание 6)
- Блокирует пользователя при более чем 10 действиях за минуту
- Блокировка на 5 минут
- Автоматическая разблокировка

### Триггер блокировки устройства (Задание 7)
- Блокирует устройство при более чем 5 обращениях за 30 секунд
- Пользователю показывается предупреждение

## Устранение неполадок

1. **Ошибка подключения к БД**
   - Проверьте параметры в `config.php`
   - Убедитесь, что MySQL запущен
   - Проверьте, что база данных создана

2. **Страница не загружается**
   - Проверьте, что PHP сервер запущен
   - Проверьте права доступа к файлам
   - Проверьте логи ошибок PHP

3. **Триггеры не работают**
   - Убедитесь, что триггеры созданы в БД
   - Проверьте логи MySQL
   - Выполните `SHOW TRIGGERS;` в MySQL

