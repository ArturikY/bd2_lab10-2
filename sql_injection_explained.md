# üîí SQL-–∏–Ω—ä–µ–∫—Ü–∏–∏: –û–±—ä—è—Å–Ω–µ–Ω–∏–µ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞—â–∏—Ç—ã

## –ß—Ç–æ —Ç–∞–∫–æ–µ SQL-–∏–Ω—ä–µ–∫—Ü–∏—è?

**SQL-–∏–Ω—ä–µ–∫—Ü–∏—è** ‚Äî —ç—Ç–æ –∞—Ç–∞–∫–∞, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–π –∑–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ –≤—Å—Ç–∞–≤–ª—è–µ—Ç –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω—ã–π SQL-–∫–æ–¥ –≤ –∑–∞–ø—Ä–æ—Å –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.

### –ü—Ä–æ—Å—Ç–æ–π –ø—Ä–∏–º–µ—Ä –∞—Ç–∞–∫–∏

–ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ, —á—Ç–æ —É –≤–∞—Å –µ—Å—Ç—å —Ç–∞–∫–æ–π **–ù–ï–ó–ê–©–ò–©–ï–ù–ù–´–ô** –∫–æ–¥:

```php
// ‚ùå –ü–õ–û–•–û - —É—è–∑–≤–∏–º–æ –∫ SQL-–∏–Ω—ä–µ–∫—Ü–∏—è–º!
$id = $_GET['device_id'];  
$query = "SELECT * FROM devices WHERE device_id = $id";
$result = mysql_query($query);
```

–ï—Å–ª–∏ –∑–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ –ø–µ—Ä–µ–¥–∞—Å—Ç –≤ URL:
```
?device_id=1' OR '1'='1
```

–¢–æ SQL-–∑–∞–ø—Ä–æ—Å —Å—Ç–∞–Ω–µ—Ç:
```sql
SELECT * FROM devices WHERE device_id = 1' OR '1'='1
```

–≠—Ç–æ –≤–µ—Ä–Ω–µ—Ç **–í–°–ï –∑–∞–ø–∏—Å–∏** –∏–∑ —Ç–∞–±–ª–∏—Ü—ã, –ø–æ—Ç–æ–º—É —á—Ç–æ `'1'='1'` –≤—Å–µ–≥–¥–∞ –∏—Å—Ç–∏–Ω–Ω–æ!

### –ë–æ–ª–µ–µ –æ–ø–∞—Å–Ω–∞—è –∞—Ç–∞–∫–∞

–ï—Å–ª–∏ –∑–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ –ø–µ—Ä–µ–¥–∞—Å—Ç:
```
?device_id=1'; DROP TABLE users; --
```

SQL —Å—Ç–∞–Ω–µ—Ç:
```sql
SELECT * FROM devices WHERE device_id = 1'; DROP TABLE users; --
```

–≠—Ç–æ **–£–î–ê–õ–ò–¢ —Ç–∞–±–ª–∏—Ü—É users**! üò±

## –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∑–∞—â–∏—Ç–∞?

### ‚úÖ Prepared Statements (–ü–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã)

–í–º–µ—Å—Ç–æ –≤—Å—Ç–∞–≤–∫–∏ –∑–Ω–∞—á–µ–Ω–∏–π –Ω–∞–ø—Ä—è–º—É—é –≤ SQL, –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º **–ø–∞—Ä–∞–º–µ—Ç—Ä—ã**:

```php
// ‚úÖ –•–û–†–û–®–û - –∑–∞—â–∏—â–µ–Ω–æ!
$id = $_GET['device_id'];
$query = "SELECT * FROM devices WHERE device_id = :id";
$stmt = $pdo->prepare($query);  // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞
$stmt->execute(['id' => $id]);  // –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ –∑–Ω–∞—á–µ–Ω–∏—è
```

**–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
1. –°–Ω–∞—á–∞–ª–∞ SQL-–∑–∞–ø—Ä–æ—Å **–∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è** —Å –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä–∞–º–∏ (`:id`)
2. –ó–Ω–∞—á–µ–Ω–∏–µ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è **–æ—Ç–¥–µ–ª—å–Ω–æ** –ø—Ä–∏ `execute()`
3. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —ç–∫—Ä–∞–Ω–∏—Ä—É–µ—Ç** –∑–Ω–∞—á–µ–Ω–∏–µ
4. –î–∞–∂–µ –µ—Å–ª–∏ –ø–µ—Ä–µ–¥–∞—Ç—å `1' OR '1'='1`, –æ–Ω–æ –±—É–¥–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ –∫–∞–∫ **–æ–±—ã—á–Ω–∞—è —Å—Ç—Ä–æ–∫–∞**, –∞ –Ω–µ –∫–∞–∫ SQL-–∫–æ–¥

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞—â–∏—Ç—ã –≤ –≤–∞—à–µ–º –∫–æ–¥–µ

### ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ 1: –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ª–∏ prepared statements?

–û—Ç–∫—Ä–æ–π—Ç–µ –ª—é–±–æ–π PHP-—Ñ–∞–π–ª (–Ω–∞–ø—Ä–∏–º–µ—Ä, `functions.php`) –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

**‚úÖ –•–û–†–û–®–û:**
```php
$query = "SELECT * FROM users WHERE USER_ID = :user_id";
$stmt = $pdo->prepare($query);
$stmt->execute(['user_id' => $user_id]);
```

**‚ùå –ü–õ–û–•–û (–µ—Å–ª–∏ –±—ã –±—ã–ª–æ —Ç–∞–∫):**
```php
$query = "SELECT * FROM users WHERE USER_ID = " . $_GET['id'];  // –ù–ï –î–ï–õ–ê–ô–¢–ï –¢–ê–ö!
```

### ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ 2: –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

–í `task8_index.php` –µ—Å—Ç—å —Ñ—É–Ω–∫—Ü–∏—è `sanitizeInput()`:

```php
function sanitizeInput($input) {
    if (is_numeric($input)) {
        return intval($input);  // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –≤ —á–∏—Å–ª–æ
    }
    return htmlspecialchars(strip_tags(trim($input)), ENT_QUOTES, 'UTF-8');
}
```

–≠—Ç–æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞—â–∏—Ç–∞: –¥–∞–∂–µ –µ—Å–ª–∏ prepared statement –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç, –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –æ—á–∏—â–µ–Ω—ã.

### ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ 3: –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —Ç–µ—Å—Ç

–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ—Ç–∫—Ä—ã—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ:

```
task8_index.php?device_id=1' OR '1'='1
history.php?device_id=1'; DROP TABLE users; --
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–æ–ª–∂–Ω–∞ —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–æ—Ä–º–∞–ª—å–Ω–æ (–Ω–µ —É–ø–∞—Å—Ç—å)
- ‚úÖ –ù–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—à–∏–±–æ–∫ SQL
- ‚úÖ –î–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã
- ‚úÖ –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `intval()`, —Å—Ç—Ä–æ–∫–∞ `1' OR '1'='1` —Å—Ç–∞–Ω–µ—Ç –ø—Ä–æ—Å—Ç–æ `1`

## –ü—Ä–∏–º–µ—Ä—ã –∞—Ç–∞–∫ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

1. **–ë–∞–∑–æ–≤–∞—è –∏–Ω—ä–µ–∫—Ü–∏—è:**
   ```
   ?device_id=1' OR '1'='1
   ```

2. **–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:**
   ```
   ?device_id=1' --
   ```

3. **–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã:**
   ```
   ?device_id=1'; DELETE FROM users WHERE '1'='1
   ```

4. **UNION-–∞—Ç–∞–∫–∞:**
   ```
   ?device_id=1' UNION SELECT * FROM users --
   ```

–í—Å–µ —ç—Ç–∏ –∞—Ç–∞–∫–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å **–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã** –≤–∞—à–∏–º –∑–∞—â–∏—â–µ–Ω–Ω—ã–º –∫–æ–¥–æ–º!

## –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –∫–æ–¥–µ

1. ‚úÖ –í—Å–µ SQL-–∑–∞–ø—Ä–æ—Å—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç `$pdo->prepare()`
2. ‚úÖ –í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ –º–∞—Å—Å–∏–≤ –≤ `execute()`
3. ‚úÖ –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã (`:id`, `:user_id`, `:command`)
4. ‚úÖ –ù–ï–¢ –∫–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü–∏–∏ —Å—Ç—Ä–æ–∫ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –≤ SQL
5. ‚úÖ –ß–∏—Å–ª–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø—Ä–µ–æ–±—Ä–∞–∑—É—é—Ç—Å—è —á–µ—Ä–µ–∑ `intval()` –∏–ª–∏ `floatval()`
6. ‚úÖ –î–ª—è –≤—ã–≤–æ–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `htmlspecialchars()` (–∑–∞—â–∏—Ç–∞ –æ—Ç XSS)

## –ò—Ç–æ–≥

**SQL-–∏–Ω—ä–µ–∫—Ü–∏—è** = –≤—Å—Ç–∞–≤–∫–∞ –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω–æ–≥–æ SQL-–∫–æ–¥–∞  
**–ó–∞—â–∏—Ç–∞** = –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ prepared statements + –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

–í–∞—à –∫–æ–¥ –∑–∞—â–∏—â–µ–Ω, –µ—Å–ª–∏:
- ‚úÖ –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç `prepare()` –∏ `execute()`
- ‚úÖ –ù–µ—Ç –ø—Ä—è–º–æ–≥–æ –≤–∫–ª—é—á–µ–Ω–∏—è `$_GET`/`$_POST` –≤ SQL-—Å—Ç—Ä–æ–∫–∏
- ‚úÖ –í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤–∞–ª–∏–¥–∏—Ä—É—é—Ç—Å—è

